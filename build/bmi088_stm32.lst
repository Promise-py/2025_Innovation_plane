ARM GAS  C:\Users\Lenovo\AppData\Local\Temp\ccpo4Yc0.s 			page 1


   1              		.cpu cortex-m3
   2              		.arch armv7-m
   3              		.fpu softvfp
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 1
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"bmi088_stm32.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.text.stm32_spi_write,"ax",%progbits
  18              		.align	1
  19              		.global	stm32_spi_write
  20              		.syntax unified
  21              		.thumb
  22              		.thumb_func
  24              	stm32_spi_write:
  25              	.LVL0:
  26              	.LFB65:
  27              		.file 1 "BMI088/Src/bmi088_stm32.c"
   1:BMI088/Src/bmi088_stm32.c **** /**\mainpage
   2:BMI088/Src/bmi088_stm32.c ****  * Copyright (C) 2017 - 2018 Bosch Sensortec GmbH
   3:BMI088/Src/bmi088_stm32.c ****  *
   4:BMI088/Src/bmi088_stm32.c ****  * Redistribution and use in source and binary forms, with or without
   5:BMI088/Src/bmi088_stm32.c ****  * modification, are permitted provided that the following conditions are met:
   6:BMI088/Src/bmi088_stm32.c ****  *
   7:BMI088/Src/bmi088_stm32.c ****  * Redistributions of source code must retain the above copyright
   8:BMI088/Src/bmi088_stm32.c ****  * notice, this list of conditions and the following disclaimer.
   9:BMI088/Src/bmi088_stm32.c ****  *
  10:BMI088/Src/bmi088_stm32.c ****  * Redistributions in binary form must reproduce the above copyright
  11:BMI088/Src/bmi088_stm32.c ****  * notice, this list of conditions and the following disclaimer in the
  12:BMI088/Src/bmi088_stm32.c ****  * documentation and/or other materials provided with the distribution.
  13:BMI088/Src/bmi088_stm32.c ****  *
  14:BMI088/Src/bmi088_stm32.c ****  * Neither the name of the copyright holder nor the names of the
  15:BMI088/Src/bmi088_stm32.c ****  * contributors may be used to endorse or promote products derived from
  16:BMI088/Src/bmi088_stm32.c ****  * this software without specific prior written permission.
  17:BMI088/Src/bmi088_stm32.c ****  *
  18:BMI088/Src/bmi088_stm32.c ****  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND
  19:BMI088/Src/bmi088_stm32.c ****  * CONTRIBUTORS "AS IS" AND ANY EXPRESS OR
  20:BMI088/Src/bmi088_stm32.c ****  * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
  21:BMI088/Src/bmi088_stm32.c ****  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
  22:BMI088/Src/bmi088_stm32.c ****  * DISCLAIMED. IN NO EVENT SHALL COPYRIGHT HOLDER
  23:BMI088/Src/bmi088_stm32.c ****  * OR CONTRIBUTORS BE LIABLE FOR ANY
  24:BMI088/Src/bmi088_stm32.c ****  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
  25:BMI088/Src/bmi088_stm32.c ****  * OR CONSEQUENTIAL DAMAGES(INCLUDING, BUT NOT LIMITED TO,
  26:BMI088/Src/bmi088_stm32.c ****  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
  27:BMI088/Src/bmi088_stm32.c ****  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
  28:BMI088/Src/bmi088_stm32.c ****  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
  29:BMI088/Src/bmi088_stm32.c ****  * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  30:BMI088/Src/bmi088_stm32.c ****  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
  31:BMI088/Src/bmi088_stm32.c ****  * ANY WAY OUT OF THE USE OF THIS
ARM GAS  C:\Users\Lenovo\AppData\Local\Temp\ccpo4Yc0.s 			page 2


  32:BMI088/Src/bmi088_stm32.c ****  * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE
  33:BMI088/Src/bmi088_stm32.c ****  *
  34:BMI088/Src/bmi088_stm32.c ****  * The information provided is believed to be accurate and reliable.
  35:BMI088/Src/bmi088_stm32.c ****  * The copyright holder assumes no responsibility
  36:BMI088/Src/bmi088_stm32.c ****  * for the consequences of use
  37:BMI088/Src/bmi088_stm32.c ****  * of such information nor for any infringement of patents or
  38:BMI088/Src/bmi088_stm32.c ****  * other rights of third parties which may result from its use.
  39:BMI088/Src/bmi088_stm32.c ****  * No license is granted by implication or otherwise under any patent or
  40:BMI088/Src/bmi088_stm32.c ****  * patent rights of the copyright holder.
  41:BMI088/Src/bmi088_stm32.c ****  *
  42:BMI088/Src/bmi088_stm32.c ****  * @file        bmi088.c
  43:BMI088/Src/bmi088_stm32.c ****  * @date        24 Aug 2018
  44:BMI088/Src/bmi088_stm32.c ****  * @version     1.2.0
  45:BMI088/Src/bmi088_stm32.c ****  *
  46:BMI088/Src/bmi088_stm32.c ****  */
  47:BMI088/Src/bmi088_stm32.c **** 
  48:BMI088/Src/bmi088_stm32.c **** /*! \file bmi088_stm32.c
  49:BMI088/Src/bmi088_stm32.c ****  \STM32 specific SPI functions */
  50:BMI088/Src/bmi088_stm32.c **** /****************************************************************************/
  51:BMI088/Src/bmi088_stm32.c **** /**\name        Header files
  52:BMI088/Src/bmi088_stm32.c ****  ****************************************************************************/
  53:BMI088/Src/bmi088_stm32.c **** #include "bmi08x.h"
  54:BMI088/Src/bmi088_stm32.c **** #include "bmi088.h"
  55:BMI088/Src/bmi088_stm32.c **** #include "bmi088_stm32.h"
  56:BMI088/Src/bmi088_stm32.c **** #include "gpio.h"
  57:BMI088/Src/bmi088_stm32.c **** 
  58:BMI088/Src/bmi088_stm32.c **** 
  59:BMI088/Src/bmi088_stm32.c **** 
  60:BMI088/Src/bmi088_stm32.c **** extern SPI_HandleTypeDef hspi2;
  61:BMI088/Src/bmi088_stm32.c **** 
  62:BMI088/Src/bmi088_stm32.c **** int8_t stm32_spi_write(uint8_t cs_pin, uint8_t reg_addr, uint8_t *data, uint16_t len)
  63:BMI088/Src/bmi088_stm32.c **** {
  28              		.loc 1 63 1 view -0
  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 8
  31              		@ frame_needed = 0, uses_anonymous_args = 0
  32              		.loc 1 63 1 is_stmt 0 view .LVU1
  33 0000 70B5     		push	{r4, r5, r6, lr}
  34              	.LCFI0:
  35              		.cfi_def_cfa_offset 16
  36              		.cfi_offset 4, -16
  37              		.cfi_offset 5, -12
  38              		.cfi_offset 6, -8
  39              		.cfi_offset 14, -4
  40 0002 82B0     		sub	sp, sp, #8
  41              	.LCFI1:
  42              		.cfi_def_cfa_offset 24
  43 0004 1546     		mov	r5, r2
  44 0006 1E46     		mov	r6, r3
  45 0008 8DF80710 		strb	r1, [sp, #7]
  64:BMI088/Src/bmi088_stm32.c **** 	reg_addr &= 0x7f;
  46              		.loc 1 64 2 is_stmt 1 view .LVU2
  47              		.loc 1 64 11 is_stmt 0 view .LVU3
  48 000c CBB2     		uxtb	r3, r1
  49              	.LVL1:
  50              		.loc 1 64 11 view .LVU4
  51 000e 03F07F03 		and	r3, r3, #127
ARM GAS  C:\Users\Lenovo\AppData\Local\Temp\ccpo4Yc0.s 			page 3


  52 0012 8DF80730 		strb	r3, [sp, #7]
  65:BMI088/Src/bmi088_stm32.c **** 	HAL_GPIO_WritePin(GPIOA, cs_pin, GPIO_PIN_RESET);
  53              		.loc 1 65 2 is_stmt 1 view .LVU5
  54 0016 0446     		mov	r4, r0
  55 0018 0022     		movs	r2, #0
  56              	.LVL2:
  57              		.loc 1 65 2 is_stmt 0 view .LVU6
  58 001a 0146     		mov	r1, r0
  59              	.LVL3:
  60              		.loc 1 65 2 view .LVU7
  61 001c 1048     		ldr	r0, .L5
  62              	.LVL4:
  63              		.loc 1 65 2 view .LVU8
  64 001e FFF7FEFF 		bl	HAL_GPIO_WritePin
  65              	.LVL5:
  66:BMI088/Src/bmi088_stm32.c **** 	HAL_SPI_Transmit(&hspi2, &reg_addr, 1, 50);
  66              		.loc 1 66 2 is_stmt 1 view .LVU9
  67 0022 3223     		movs	r3, #50
  68 0024 0122     		movs	r2, #1
  69 0026 0DF10701 		add	r1, sp, #7
  70 002a 0E48     		ldr	r0, .L5+4
  71 002c FFF7FEFF 		bl	HAL_SPI_Transmit
  72              	.LVL6:
  67:BMI088/Src/bmi088_stm32.c **** 	while(HAL_SPI_GetState(&hspi2) == HAL_SPI_STATE_BUSY);
  73              		.loc 1 67 2 view .LVU10
  74              	.L2:
  75              		.loc 1 67 55 discriminator 1 view .LVU11
  76              		.loc 1 67 7 discriminator 1 view .LVU12
  77              		.loc 1 67 8 is_stmt 0 discriminator 1 view .LVU13
  78 0030 0C48     		ldr	r0, .L5+4
  79 0032 FFF7FEFF 		bl	HAL_SPI_GetState
  80              	.LVL7:
  81              		.loc 1 67 7 discriminator 1 view .LVU14
  82 0036 0228     		cmp	r0, #2
  83 0038 FAD0     		beq	.L2
  68:BMI088/Src/bmi088_stm32.c **** 	HAL_SPI_Transmit(&hspi2, data, len, 50);
  84              		.loc 1 68 2 is_stmt 1 view .LVU15
  85 003a 3223     		movs	r3, #50
  86 003c 3246     		mov	r2, r6
  87 003e 2946     		mov	r1, r5
  88 0040 0848     		ldr	r0, .L5+4
  89 0042 FFF7FEFF 		bl	HAL_SPI_Transmit
  90              	.LVL8:
  69:BMI088/Src/bmi088_stm32.c **** 	while(HAL_SPI_GetState(&hspi2) == HAL_SPI_STATE_BUSY);
  91              		.loc 1 69 2 view .LVU16
  92              	.L3:
  93              		.loc 1 69 55 discriminator 1 view .LVU17
  94              		.loc 1 69 7 discriminator 1 view .LVU18
  95              		.loc 1 69 8 is_stmt 0 discriminator 1 view .LVU19
  96 0046 0748     		ldr	r0, .L5+4
  97 0048 FFF7FEFF 		bl	HAL_SPI_GetState
  98              	.LVL9:
  99              		.loc 1 69 7 discriminator 1 view .LVU20
 100 004c 0228     		cmp	r0, #2
 101 004e FAD0     		beq	.L3
  70:BMI088/Src/bmi088_stm32.c **** 	HAL_GPIO_WritePin(GPIOA, cs_pin, GPIO_PIN_SET);
 102              		.loc 1 70 2 is_stmt 1 view .LVU21
ARM GAS  C:\Users\Lenovo\AppData\Local\Temp\ccpo4Yc0.s 			page 4


 103 0050 0122     		movs	r2, #1
 104 0052 2146     		mov	r1, r4
 105 0054 0248     		ldr	r0, .L5
 106 0056 FFF7FEFF 		bl	HAL_GPIO_WritePin
 107              	.LVL10:
  71:BMI088/Src/bmi088_stm32.c **** 	return 0;
 108              		.loc 1 71 2 view .LVU22
  72:BMI088/Src/bmi088_stm32.c **** }
 109              		.loc 1 72 1 is_stmt 0 view .LVU23
 110 005a 0020     		movs	r0, #0
 111 005c 02B0     		add	sp, sp, #8
 112              	.LCFI2:
 113              		.cfi_def_cfa_offset 16
 114              		@ sp needed
 115 005e 70BD     		pop	{r4, r5, r6, pc}
 116              	.LVL11:
 117              	.L6:
 118              		.loc 1 72 1 view .LVU24
 119              		.align	2
 120              	.L5:
 121 0060 00080140 		.word	1073809408
 122 0064 00000000 		.word	hspi2
 123              		.cfi_endproc
 124              	.LFE65:
 126              		.section	.text.stm32_spi_read,"ax",%progbits
 127              		.align	1
 128              		.global	stm32_spi_read
 129              		.syntax unified
 130              		.thumb
 131              		.thumb_func
 133              	stm32_spi_read:
 134              	.LVL12:
 135              	.LFB66:
  73:BMI088/Src/bmi088_stm32.c **** 
  74:BMI088/Src/bmi088_stm32.c **** int8_t stm32_spi_read(uint8_t cs_pin, uint8_t reg_addr, uint8_t *data, uint16_t len)
  75:BMI088/Src/bmi088_stm32.c **** {
 136              		.loc 1 75 1 is_stmt 1 view -0
 137              		.cfi_startproc
 138              		@ args = 0, pretend = 0, frame = 8
 139              		@ frame_needed = 0, uses_anonymous_args = 0
 140              		.loc 1 75 1 is_stmt 0 view .LVU26
 141 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 142              	.LCFI3:
 143              		.cfi_def_cfa_offset 24
 144              		.cfi_offset 4, -24
 145              		.cfi_offset 5, -20
 146              		.cfi_offset 6, -16
 147              		.cfi_offset 7, -12
 148              		.cfi_offset 8, -8
 149              		.cfi_offset 14, -4
 150 0004 82B0     		sub	sp, sp, #8
 151              	.LCFI4:
 152              		.cfi_def_cfa_offset 32
 153 0006 1546     		mov	r5, r2
 154 0008 1E46     		mov	r6, r3
 155 000a 8DF80710 		strb	r1, [sp, #7]
  76:BMI088/Src/bmi088_stm32.c **** 	reg_addr |= 0x80;
ARM GAS  C:\Users\Lenovo\AppData\Local\Temp\ccpo4Yc0.s 			page 5


 156              		.loc 1 76 2 is_stmt 1 view .LVU27
 157              		.loc 1 76 11 is_stmt 0 view .LVU28
 158 000e CBB2     		uxtb	r3, r1
 159              	.LVL13:
 160              		.loc 1 76 11 view .LVU29
 161 0010 63F07F03 		orn	r3, r3, #127
 162 0014 8DF80730 		strb	r3, [sp, #7]
  77:BMI088/Src/bmi088_stm32.c **** 	HAL_GPIO_WritePin(GPIOA, cs_pin, GPIO_PIN_RESET);
 163              		.loc 1 77 2 is_stmt 1 view .LVU30
 164 0018 0446     		mov	r4, r0
 165 001a 0F4F     		ldr	r7, .L9
 166 001c 0022     		movs	r2, #0
 167              	.LVL14:
 168              		.loc 1 77 2 is_stmt 0 view .LVU31
 169 001e 0146     		mov	r1, r0
 170              	.LVL15:
 171              		.loc 1 77 2 view .LVU32
 172 0020 3846     		mov	r0, r7
 173              	.LVL16:
 174              		.loc 1 77 2 view .LVU33
 175 0022 FFF7FEFF 		bl	HAL_GPIO_WritePin
 176              	.LVL17:
  78:BMI088/Src/bmi088_stm32.c **** 	HAL_SPI_Transmit(&hspi2, &reg_addr, 1, 50);
 177              		.loc 1 78 2 is_stmt 1 view .LVU34
 178 0026 DFF83480 		ldr	r8, .L9+4
 179 002a 3223     		movs	r3, #50
 180 002c 0122     		movs	r2, #1
 181 002e 0DF10701 		add	r1, sp, #7
 182 0032 4046     		mov	r0, r8
 183 0034 FFF7FEFF 		bl	HAL_SPI_Transmit
 184              	.LVL18:
  79:BMI088/Src/bmi088_stm32.c **** 	HAL_SPI_Receive(&hspi2, data, len, 50);
 185              		.loc 1 79 2 view .LVU35
 186 0038 3223     		movs	r3, #50
 187 003a 3246     		mov	r2, r6
 188 003c 2946     		mov	r1, r5
 189 003e 4046     		mov	r0, r8
 190 0040 FFF7FEFF 		bl	HAL_SPI_Receive
 191              	.LVL19:
  80:BMI088/Src/bmi088_stm32.c **** 	HAL_GPIO_WritePin(GPIOA, cs_pin, GPIO_PIN_SET);
 192              		.loc 1 80 2 view .LVU36
 193 0044 0122     		movs	r2, #1
 194 0046 2146     		mov	r1, r4
 195 0048 3846     		mov	r0, r7
 196 004a FFF7FEFF 		bl	HAL_GPIO_WritePin
 197              	.LVL20:
  81:BMI088/Src/bmi088_stm32.c **** 
  82:BMI088/Src/bmi088_stm32.c **** 	
  83:BMI088/Src/bmi088_stm32.c **** 
  84:BMI088/Src/bmi088_stm32.c **** 	return 0;
 198              		.loc 1 84 2 view .LVU37
  85:BMI088/Src/bmi088_stm32.c **** }
 199              		.loc 1 85 1 is_stmt 0 view .LVU38
 200 004e 0020     		movs	r0, #0
 201 0050 02B0     		add	sp, sp, #8
 202              	.LCFI5:
 203              		.cfi_def_cfa_offset 24
ARM GAS  C:\Users\Lenovo\AppData\Local\Temp\ccpo4Yc0.s 			page 6


 204              		@ sp needed
 205 0052 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 206              	.LVL21:
 207              	.L10:
 208              		.loc 1 85 1 view .LVU39
 209 0056 00BF     		.align	2
 210              	.L9:
 211 0058 00080140 		.word	1073809408
 212 005c 00000000 		.word	hspi2
 213              		.cfi_endproc
 214              	.LFE66:
 216              		.text
 217              	.Letext0:
 218              		.file 2 "d:\\gnu arm embedded toolchain\\10 2021.10\\arm-none-eabi\\include\\machine\\_default_typ
 219              		.file 3 "d:\\gnu arm embedded toolchain\\10 2021.10\\arm-none-eabi\\include\\sys\\_stdint.h"
 220              		.file 4 "Drivers/CMSIS/Device/ST/STM32F1xx/Include/stm32f103xb.h"
 221              		.file 5 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_def.h"
 222              		.file 6 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_gpio.h"
 223              		.file 7 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_dma.h"
 224              		.file 8 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_spi.h"
ARM GAS  C:\Users\Lenovo\AppData\Local\Temp\ccpo4Yc0.s 			page 7


DEFINED SYMBOLS
                            *ABS*:00000000 bmi088_stm32.c
C:\Users\Lenovo\AppData\Local\Temp\ccpo4Yc0.s:18     .text.stm32_spi_write:00000000 $t
C:\Users\Lenovo\AppData\Local\Temp\ccpo4Yc0.s:24     .text.stm32_spi_write:00000000 stm32_spi_write
C:\Users\Lenovo\AppData\Local\Temp\ccpo4Yc0.s:121    .text.stm32_spi_write:00000060 $d
C:\Users\Lenovo\AppData\Local\Temp\ccpo4Yc0.s:127    .text.stm32_spi_read:00000000 $t
C:\Users\Lenovo\AppData\Local\Temp\ccpo4Yc0.s:133    .text.stm32_spi_read:00000000 stm32_spi_read
C:\Users\Lenovo\AppData\Local\Temp\ccpo4Yc0.s:211    .text.stm32_spi_read:00000058 $d

UNDEFINED SYMBOLS
HAL_GPIO_WritePin
HAL_SPI_Transmit
HAL_SPI_GetState
hspi2
HAL_SPI_Receive
